{% extends '@IQ2iArqui/base.html.twig' %}

{% block html_classes %}h-full bg-white dark:bg-gray-900{% endblock %}
{% block body_classes %}h-full{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('/bundles/iq2iarqui/arqui.css') }}"/>
{% endblock %}

{% block javascripts %}
    <script type="importmap">
        {
            "imports": {
                "arqui": "{{ asset('/bundles/iq2iarqui/arqui.js') }}",
                    "@hotwired/stimulus": "{{ asset('/bundles/iq2iarqui/vendor/stimulus/stimulus.js') }}",
                    "highlight.js/lib/core": "{{ asset('/bundles/iq2iarqui/vendor/highlight.js/lib/core.js') }}",
                    "highlight.js/lib/languages/twig": "{{ asset('/bundles/iq2iarqui/vendor/highlight.js/lib/languages/twig.js') }}",
                    "highlight.js/lib/languages/xml": "{{ asset('/bundles/iq2iarqui/vendor/highlight.js/lib/languages/xml.js') }}"
                }
            }
    </script>
    <script type="module">import 'arqui';</script>
{% endblock %}

{% block body %}
    <div class="fixed inset-y-0 z-50 flex w-72 flex-col">
        <div class="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-600 dark:bg-gray-800">
            <div class="flex h-16 shrink-0 items-center">
                <svg class="h-10 w-auto mr-3" xmlns="http://www.w3.org/2000/svg" width="266.667" height="266.667" viewBox="0 0 200 200">
                    <g fill="#f56464">
                        <path d="M73 24.5V36h8.6c6.4 0 8.5.3 8.2 1.2-.3.9-3.2 1.4-8.6 1.6l-8.2.3V56h6c4.7 0 6 .3 6 1.5S83.7 59 79 59h-6v18h8.5c6.9 0 8.5.3 8.5 1.5S88.4 80 81.5 80H73v17h6c5.3 0 6 .2 6 2s-.7 2-6 2h-6v17h8.5c6.9 0 8.5.3 8.5 1.5s-1.6 1.5-8.5 1.5H73v18h6c4.7 0 6 .3 6 1.5s-1.3 1.5-6 1.5h-6v45h29V13H73v11.5zm19.5 144c6.3 6.2-.1 15.4-8.3 11.9-7.3-3-4.2-14.3 4.1-14.4 1 0 2.9 1.1 4.2 2.5z"/>
                        <path d="M85.2 170.6c-3.7 2.6-2.3 7.4 2.3 7.4 4.3 0 5.9-4.4 2.7-7.3-2.3-2.1-2.2-2.1-5-.1zM157 74.4v61.4l4.4.6c2.5.4 6.3 2 8.5 3.7l4.1 2.9V83.7c0-55.8-.1-59.4-1.9-62.7-2.1-4-8.3-8-12.3-8H157v61.4zM26 100v70h44V30H26v70z"/>
                        <path d="M105 100v70h28.2c26.1 0 28.5-.1 32.3-2 5.7-2.7 8.9-8.6 8.2-14.7-.9-7.9-6.2-13-14.5-14l-5.2-.6V30h-49v70z"/>
                    </g>
                </svg>
                <span class="self-center text-3xl font-semibold whitespace-nowrap dark:text-white">ArquiBundle</span>
            </div>

            <nav class="flex flex-1 flex-col">
                <ul role="list" class="flex flex-1 flex-col gap-y-7">
                    <li>
                        <ul role="list" class="-mx-2 space-y-1">
                            {% for menu_item in menu %}
                                {% if menu_item.children is defined %}
                                    <li>
                                        <div data-controller="menu" data-menu-opened-value="{{ menu_item.opened ? 'true' : 'false' }}" data-menu-opened-class="rotate-0" data-menu-closed-class="rotate-90">
                                            <button type="button" class="flex items-center w-full p-2 text-base text-gray-900 transition duration-75 rounded-lg group hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700" aria-controls="sub-menu-1" aria-expanded="true" data-action="menu#toggle">
                                                <span class="flex-1 ms-3 text-left rtl:text-right whitespace-nowrap">{{ menu_item.label }}</span>
                                                <svg class="w-3 h-3 me-3 rotate-90" data-menu-target="svg" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"></path>
                                                </svg>
                                            </button>
                                            <ul class="mt-1 hidden" id="sub-menu-1" data-menu-target="submenu">
                                                {% for submenu_item in menu_item.children %}
                                                    <li>
                                                        <a href="{{ submenu_item.url }}" class="flex items-center w-full p-2 text-gray-900 transition duration-75 rounded-lg pl-11 group hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700 {% if submenu_item.active %}bg-gray-100 dark:bg-gray-700{% endif %}">
                                                            {{ submenu_item.label }}
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </li>
                                {% else %}
                                    <li>
                                        <a href="{{ menu_item.url }}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group {% if menu_item.active %}bg-gray-100 dark:bg-gray-700{% endif %}">
                                            <span class="ms-3">{{ menu_item.label }}</span>
                                        </a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="flex flex-col pl-72 h-full" data-controller="iframe-size">
        {% if component is not null %}
            <header class="sticky top-0 z-40 flex h-16 shrink-0 justify-between gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8 dark:border-gray-600 dark:bg-gray-900">
                <div class="flex w-full px-2 lg:px-0 items-center justify-between">
                    <h1 class="flex items-center text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                        {{ component.name }} - {{ component.variant.name }}

                        <a href="{{ path('iq2i_arqui_iframe', { component, variant: component.variant }) }}" target="_blank">
                            <svg class="ml-4 w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                        </a>
                    </h1>

                    <span class="text-xl font-light text-gray-900 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-500" data-iframe-size-target="size"></span>
                </div>
            </header>
        {% endif %}

        {% if tabs is defined %}
            <div class="text-sm font-medium text-center text-gray-500 border-b border-gray-200 px-4 sm:px-6 lg:px-8 dark:text-gray-400 dark:border-gray-600">
                <ul class="flex flex-wrap -mb-px">
                    {% for tab in tabs %}
                        <li class="me-2">
                            <a href="{{ tab.url }}" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg {% if tab.active %}text-blue-600 border-blue-600 dark:text-blue-500 dark:border-blue-500{% else %}hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300{% endif %}">
                                {{ tab.label }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <main class="flex flex-col flex-1 divide-y divide-gray-200 dark:divide-gray-600" data-controller="tab">
            {% if component is not null %}
                <div class="flex" style="height: 256px;">
                    <div class="relative w-full" data-iframe-size-target="iframe">
                        <iframe src="{{ path('iq2i_arqui_iframe', {component, variant: component.variant}) }}" class="absolute inset-0 w-full h-full"></iframe>
                    </div>
                </div>

                <div class="text-sm font-medium text-center text-gray-500 border-b border-gray-200 px-4 sm:px-6 lg:px-8 dark:text-gray-400 dark:border-gray-600">
                    <ul class="flex flex-wrap -mb-px">
                        <li class="me-2">
                            <a href="#twig" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg tab-is-active" data-tab-target="tab" data-action="click->tab#change">
                                Twig
                            </a>
                        </li>
                        <li class="me-2">
                            <a href="#html" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg tab-is-unactive" data-tab-target="tab" data-action="click->tab#change">
                                HTML
                            </a>
                        </li>
                        <li class="me-2">
                            <a href="#notes" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg tab-is-unactive" data-tab-target="tab" data-action="click->tab#change">
                                Notes
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="h-full">
                    <div id="twig" class="relative h-full group" data-controller="copy-to-clipboard" data-copy-to-clipboard-content-value="{{ component.twigContent }}" data-tab-target="tabPanel">
                        <div class="overflow-x-auto p-4">
                            <pre><code class="language-twig" data-controller="highlight">
                                {{- component.twigContent -}}
                            </code></pre>
                        </div>

                        <button type="button" class="absolute top-4 right-4 transform translate-x-14 group-hover:translate-x-0 transition duration-200 rounded-full bg-indigo-600 p-2 text-white shadow-sm hover:bg-indigo-500" data-action="copy-to-clipboard#copy">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-copy-to-clipboard-target="svg">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <span class="hidden block text-xs" data-copy-to-clipboard-target="text">Copied!</span>
                        </button>
                    </div>

                    <div id="html" class="hidden relative h-full group" data-controller="copy-to-clipboard" data-copy-to-clipboard-content-value="{{ component.htmlContent }}" data-tab-target="tabPanel">
                        <div class="overflow-x-auto p-4">
                            <pre><code class="language-html" data-controller="highlight">
                                {{- component.htmlContent -}}
                            </code></pre>
                        </div>

                        <button type="button" class="absolute top-4 right-4 transform translate-x-14 group-hover:translate-x-0 transition duration-200 rounded-full bg-indigo-600 p-2 text-white shadow-sm hover:bg-indigo-500" data-action="copy-to-clipboard#copy">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-copy-to-clipboard-target="svg">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <span class="hidden block text-xs" data-copy-to-clipboard-target="text">Copied!</span>
                        </button>
                    </div>

                    <div id="notes" class="hidden h-full" data-tab-target="tabPanel">
                        <div class="p-4 prose dark:prose-invert">
                            {% if component.markdownContent is not null %}
                                {{ component.markdownContent|raw }}
                            {% else %}
                                <em>No notes defined.</em>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </main>
    </div>
{% endblock %}
